# 网络 key - value 数据库项目介绍

## 一、项目概述
根据自从父亲的民宿接入"旅馆小帮手"系统后，订单数据就像被哈士奇啃过的账本。张阿姨预定的山景房显示成"后厨洗碗工位"，客人寄存的行李箱在系统里凭空消失。小爪一查代码，发现所有数据都被胡乱无序地塞进十几个txt文件里。

而且小爪有时候发现不在家的时候如果也能工作，不就更方便了吗？为此他去了解了网络传输的基本原理，学习socket编程技术，成功让自己在外出出差的时候也能够工作。

正巧，小爪还学了一门叫做数据结构的课程。这里讲授了很多种存储结构，他发现了一个神奇的结构----哈希表。它是一种k-v结构，其中，key可以用来标识这个数据，value用来存储具体数据。想到这里，小爪很兴奋，他有了更好的想法：既然key可以标识一个数据，那也可以用来标识一组相同类型的数据；，那再封装一下，不还可以变成队列(先进先出)和栈(后进先出)吗？

见识到哈希表的灵活与精准，小爪当即决定"用哈希表重写！"小爪连夜给每个客人分配唯一ID当key，订单数据用队列存，特色服务用栈存。结果凌晨三点系统突然抽风——301房客人点"叫早服务"时，屏幕弹出刺眼的NullPointerException，机器人管家对着空房间喊了半小时"早上好"，把新入住的客人吓到报警。

而且记性不好的他居然将之前学过的集合框架都忘了，去哪找可以左进右进，左出右出的数据结构呢？

你能帮小爪设计个防手残的网络key-value数据库吗？至少别再让机器人对着空气说"祝您入住愉快"了！而成的项目

本项目是一个基于Java语言开发的网络 key - value 数据库，包含服务端和客户端两部分。通过该系统，用户可以在客户端向服务端发送各种指令，实现对不同类型数据（字符串、双向链表、哈希类型）的存储、读取、删除等操作，同时具备数据持久化、多线程处理客户端请求、日志记录等功能。

## 二、功能特性
### （一）指令功能
1. **字符串类型操作**
    - `set [key] [value]`：存储一个键值对，`key` 用于标识数据，`value` 为具体的字符串数据。
    - `get [key]`：根据给定的 `key` 获取对应的 `value`，若 `key` 不存在则返回 `null`。
    - `del [key]`：删除指定 `key` 对应的键值对。
2. **双向链表类型操作**
    - `lpush [key] [value]`：将数据从双向链表的左端插入。
    - `rpush [key] [value]`：将数据从双向链表的右端插入。
    - `range [key] [start] [end]`：获取指定 `key` 对应的双向链表中，从 `start` 位置到 `end` 位置的数据。
    - `len [key]`：获取指定 `key` 存储的双向链表数据的个数。
    - `lpop [key]`：获取并删除指定 `key` 对应的双向链表最左端的数据。
    - `rpop [key]`：获取并删除指定 `key` 对应的双向链表最右端的数据。
    - `ldel [key]`：删除指定 `key` 对应的整个双向链表数据。
3. **哈希类型操作**
    - `hset [key] [field] [value]`：在指定 `key` 对应的哈希数据结构中，存储一个字段 - 值对，`field` 为字段名，`value` 为字段对应的值。
    - `hget [key] [field]`：获取指定 `key` 中指定 `field` 字段对应的 `value`，若不存在则返回 `null`。
    - `hdel [key] [field]`：删除指定 `key` 中指定 `field` 字段及其对应的值；`hdel [key]` 用于删除指定 `key` 对应的所有哈希数据。
4. **其他指令**
    - `ping`：心跳指令，客户端发送该指令，服务端响应 `pong`，用于检测连接状态。
    - `help`：获取所有可用指令的使用方式；`help [command]` 用于获取单个指定指令的使用方式。

### （二）其他功能
1. **多线程处理**：服务端使用线程池（`ExecutorService`）实现多线程，能够同时处理多个客户端的连接请求，提高系统的并发处理能力。
2. **数据持久化**：系统可以将 `set` 和 `del` 指令相关的数据持久化到文件中，在程序启动时自动读取已持久化的数据，保证数据的持续性。
3. **日志记录**：能够记录连接程序的客户端 `IP` 信息以及程序运行时出现的异常信息，便于排查问题和监控系统运行状态。日志文件路径可通过配置文件进行配置。
4. **配置文件管理**：通过配置文件（`config.properties`）存储监听端口号、日志文件路径、数据持久化文件路径等重要配置信息，方便进行系统参数的调整和管理。

## 三、项目结构
### （一）文件结构
1. **`config.properties`**：配置文件，用于存储系统相关配置参数，如监听端口号、日志文件路径、数据持久化文件路径等。
2. **服务端代码**：位于 `server` 包下，主要类为 `ServerMain`（假设主类名为 `ServerMain` ），负责启动服务器，监听客户端连接，处理客户端发送的各种指令，管理数据存储和持久化，以及记录日志等操作。
3. **客户端代码**：位于 `client` 包下，主要类为 `Client`，负责建立与服务端的连接，向服务端发送用户输入的指令，并接收和显示服务端返回的响应结果。

### （二）类与方法说明
1. **`ServerMain` 类**
    - **成员变量**：包含用于存储不同类型数据（字符串、双向链表、哈希类型）的 `Map` 集合，线程池对象，日志文件对象，数据持久化文件对象以及监听端口号等。
    - **主要方法**
        - `main` 方法：程序入口，负责初始化服务器，监听客户端连接，并将客户端连接任务提交给线程池处理。
        - 指令处理方法：如 `handleSet`、`handleGet` 等一系列以 `handle` 开头的方法，分别用于处理不同的指令请求，执行相应的数据操作，并返回处理结果。
        - 辅助方法：如 `loadData` 用于加载持久化数据，`log` 和 `logError` 用于记录日志和错误日志，`persistData` 用于将数据持久化到文件等。
2. **`ClientMain` 类**
    - **`main` 方法**：程序入口，负责建立与服务端的 `Socket` 连接，创建输入输出流，读取用户输入的指令并发送给服务端，同时接收并显示服务端返回的响应信息。

## 四、运行说明
### 运行步骤
1. 确保 `config.properties` 文件中的配置参数正确，如监听端口号未被占用等。
2. 先启动服务端：运行 `server` 包下的 `ServerMain` 类的 `main` 方法，启动服务器，服务器将开始监听指定端口，等待客户端连接。
3. 再启动客户端：运行 `client` 包下的 `Client` 类的 `main` 方法，客户端将尝试连接到服务端。连接成功后，在客户端命令行界面会出现提示符（如 `127.0.0.1:端口号>` ），此时用户可以输入各种指令与服务端进行交互。 
